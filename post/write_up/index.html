<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.40.3" />
  <meta name="author" content="Graham Tierney">

  
  
  
  
    
      
    
  
  <meta name="description" content="IntroductionLast spring, I took a class on Bayesian statistics at the University of Chicago that had several exercises focused on building a model to classify species based on their genome. The basic setup was that you were given a data set of salmon, their genome sequencing data, and which sub-population they belonged to. From this data, we needed to build a model to classify new salmon into the sub-populations. The strategy was to use the fact that alleles appeared with different frequencies in the different sub-populations, so the fact that a new fish did have certain alleles and did not have others was informative about which sub-population it came from.">

  
  <link rel="alternate" hreflang="en-us" href="/post/write_up/">

  


  

  
  
  <meta name="theme-color" content="#0095eb">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Graham Tierney">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Graham Tierney">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/write_up/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@gtyranny">
  <meta property="twitter:creator" content="@gtyranny">
  
  <meta property="og:site_name" content="Graham Tierney">
  <meta property="og:url" content="/post/write_up/">
  <meta property="og:title" content="The Genetics of Magic | Graham Tierney">
  <meta property="og:description" content="IntroductionLast spring, I took a class on Bayesian statistics at the University of Chicago that had several exercises focused on building a model to classify species based on their genome. The basic setup was that you were given a data set of salmon, their genome sequencing data, and which sub-population they belonged to. From this data, we needed to build a model to classify new salmon into the sub-populations. The strategy was to use the fact that alleles appeared with different frequencies in the different sub-populations, so the fact that a new fish did have certain alleles and did not have others was informative about which sub-population it came from.">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-05-10T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2018-05-10T00:00:00&#43;00:00">
  

  
  

  <title>The Genetics of Magic | Graham Tierney</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Graham Tierney</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#publications">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Blog Posts</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">The Genetics of Magic</h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2018-05-10 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      May 10, 2018
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Graham Tierney">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    19 min read
  </span>
  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/r/">R</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=The%20Genetics%20of%20Magic&amp;url=%2fpost%2fwrite_up%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fwrite_up%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fwrite_up%2f&amp;title=The%20Genetics%20of%20Magic"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fwrite_up%2f&amp;title=The%20Genetics%20of%20Magic"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=The%20Genetics%20of%20Magic&amp;body=%2fpost%2fwrite_up%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      <div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Last spring, I took a class on Bayesian statistics at the University of Chicago that had several exercises focused on building a model to classify species based on their genome. The basic setup was that you were given a data set of salmon, their genome sequencing data, and which sub-population they belonged to. From this data, we needed to build a model to classify new salmon into the sub-populations. The strategy was to use the fact that alleles appeared with different frequencies in the different sub-populations, so the fact that a new fish did have certain alleles and did not have others was informative about which sub-population it came from.</p>
<p>This problem and solution struck me as being very similar to an issue near and dear to my heart: classifying decks into archetypes in collectible card games (CCGs). Specifically, Magic the Gathering. One could think of alleles as analogues for cards and the sub-populations as analogues for deck archetypes (UW Control, Jund, Merfolk, etc.). In this post, I will describe how to apply a Bayesian classification algorithm to this scenario and discuss some of its advantages. I assume the reader has familiarity with basic mathematical probability and statistics. I also will not show proofs for the mathematical claims that I make, but I will try to explain the intuition behind the concepts. Knowing the application area, collectible card games and Magic, will be necessary to understand the examples and potential issues with different methods.</p>
<p>Ultimately, with very minimal data cleaning, I am able to accurately classify 86% of decks played in a testing sample. Frequently played archetypes and archetypes that share few cards with others are more accurately classified. I also describe some simple human-implementable improvements and additional features that should be included in practice.</p>
</div>
<div id="the-problem" class="section level2">
<h2>The Problem</h2>
<p>Magic, and collectible card games broadly, are usually two-player games where each player brings their own deck of different cards. Many tournament-caliber decks are categorized into broader archetypes that differ only slightly. For example, Merfolk is a deck that plays creature cards with the Merfolk creature type and “lords” that give bonuses to all Merfolk cards. Not all Merfolk decks are identical, but a human who knows the game well can easily look at a deck-list and say if it is a Merfolk deck or not. Jund is a deck that plays green, black, and red cards that focus on trading resources with the opponent while eking out small advantages in each exchange. The variety of cards played in Jund is significantly higher than the variety of cards played in Merfolk decks.</p>
<p>Classifying a single deck into an archetypes is an easy task for a human who knows the game well, but frequently this classification has to be done at scale. Large tournaments happen every weekend, thousands of matches are played online every day, and it would take an extremely large team to classify all of those decks. A classification algorithm would ideally give a data-driven, suggested archetype and express how uncertain it was about that suggestion.</p>
<p>I know of two types of practitioners who face this problem. First are the companies that make collectible card games, e.g. Wizards of the Coast for Magic or Blizzard for Hearthstone. They are often interested in assessing whether there is a sufficiently diverse array of successful archetypes to satisfy players, which requires efficiently classifying decks then calculating things like play- and win-rates by archetype. The developers can then either ban or change existing cards to improve the format. Second are third-party websites. They often provide “meta-game reports” that cover which archetypes are successful or likely to become successful. For them, the value of archetype statistics is simply to report them to players who have to decide which deck to bring to a tournament.</p>
</div>
<div id="the-data" class="section level2">
<h2>The Data</h2>
<p>The method I will describe relies on having a lot of decks with known archetypes. I will use data from <a href="https://www.mtggoldfish.com/">MTG Goldfish</a> on Modern decks played in Star City Games (SCG) events from 2014 to the present. Modern is a non-rotating format, which means that cards from older sets will always be legal in the format. In a rotating format like Standard, where only cards from sets released in the past two years are legal, data on older decks is not useful to classify newer decks. Additionally, the names of deck archetypes at Star City Games events are more standardized than the weekly data from Magic Online (MTGO), the digital version of the game. The algorithm could be used in these other scenarios with enough data, but deck-lists are only released for top finishers at SCG events and on MTGO.</p>
<p>Over the 802 tournaments, I observe 7,844 unique decks, 500 unique deck archetypes, and 1,741 unique cards. I will separate a 300 deck sample to use for testing after constructing the model.</p>
</div>
<div id="the-method" class="section level2">
<h2>The Method</h2>
<p>I’ll start by defining some notation. <span class="math inline">\(D_{new}\)</span> is a new deck that needs to be classified into an archetype. It is a list of card names and card quantities. It looks like this:</p>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
card
</th>
<th style="text-align:right;">
number
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Delver of Secrets
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
Snapcaster Mage
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
Young Pyromancer
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
Tasigur, the Golden Fang
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
Gurmag Angler
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
Dispel
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>We also have a set of training decks. The same card name and card quantity variables are included, but it also includes the true archetype name. The ultimate goal is to use the information in the training decks to classify a new deck of an unknown archetype.</p>
<div id="maximum-likelihood" class="section level3">
<h3>Maximum Likelihood</h3>
<p>The simplest approach to the classification problem is to use a maximum likelihood estimation. In the training set, find the frequency that each card <span class="math inline">\(c\)</span> appears among cards in archetype <span class="math inline">\(i\)</span> and treat this as the probability that a random card from archetype <span class="math inline">\(i\)</span> will be card <span class="math inline">\(c\)</span>. For example, 1,555 Lightning Bolts appear among the 24,622 cards in Jund decks, so this probability would be estimated as 0.06. The likelihood that <span class="math inline">\(D_{new}\)</span> came from archetype <span class="math inline">\(i\)</span> can be thought of as the probability that 60 draws with replacement from a pool of every Magic card will result in <span class="math inline">\(D_{new}\)</span> when the probability of drawing each card is given by the probabilities estimated in the training data. Formally, this is a draw of size 60 from a multinomial distribution on the population of every Magic card and probability parameters <span class="math inline">\(p_i = &lt;p_{i,1},...,p_{i,1741}&gt;\)</span> where <span class="math inline">\(p_{i,c}\)</span> is the proportion of card <span class="math inline">\(c\)</span> among cards in archetype <span class="math inline">\(i\)</span>. This is written below (note that <span class="math inline">\(x_c\)</span> is the number of times card <span class="math inline">\(c\)</span> appeared in <span class="math inline">\(D_{new}\)</span>):</p>
<p><span class="math display">\[P(D_{new}|\text{archetype}=i) = \frac{60!}{x_1! ... x_{1741}!} \prod_{c=i}^{1741}p_{c,i}^{x_c} \propto \prod_{c=i}^{1741}p_{c,i}^{x_c} \]</span></p>
<p>The most relevant part of this probability is the large product of each card frequency for each time it appears in <span class="math inline">\(D_{new}\)</span>. The factorials just count the number of ways <span class="math inline">\(D_{new}\)</span> could have been drawn. However, it can be completely ignored! We will classify <span class="math inline">\(D_{new}\)</span> as whatever archetype maximizes the likelihood. The factorials are the same for every archetype, so ignoring them will not change the result.</p>
<p>The biggest drawback of this method is that if a card is never observed in a given archetype in the training data, the estimated likelihood that any deck containing that card is of that archetype is zero. This can be particularly problematic. A blue-white control deck that decides to use Baneslayer Angel as a finisher might have 59 cards identical to a blue-white control deck in the training set, but it will have a likelihood of zero if no training blue-white control deck contained Baneslayer Angel.</p>
<p>The solution to this problem is to add pseudo counts to every deck in the training set. Suppose you round every zero frequency to some small number, say 0.01. Now if a new card appears in an archetype, the likelihood will not be zero, and if the rest of the deck matches a known archetype well, it can still be correctly classified. Picking this pseudo count number can be hard. It should maybe even be different for different decks based on how many times that archetype is observed in the training set because you are likely more confident in zero frequencies for decks that you observe many times.</p>
</div>
<div id="bayesian-modeling" class="section level3">
<h3>Bayesian Modeling</h3>
<p>The method I propose is essentially a more rigorous way of adding these pseudo counts by putting a Bayesian prior on the frequencies. A useful distribution on a set of frequencies is the Dirichlet distribution. A draw from an n-dimensional Dirichlet distribution is a set of n positive numbers that sum to one. Note that n-1 dimensions identify the sample because the last dimension must ensure the values all sum to one. It has n parameters, call each <span class="math inline">\(\alpha_c\)</span>, and the expected value for <span class="math inline">\(p_c\)</span>, the frequency of card <span class="math inline">\(c\)</span>, is <span class="math inline">\(\alpha_c/\sum_{j=1}^n \alpha_j\)</span>. As <span class="math inline">\(\alpha_c\)</span> increases, the variance decreases. To understand this distribution, its useful to first consider the two-dimensional case, called a <a href="https://stephens999.github.io/fiveMinuteStats/beta.html">Beta distribution</a>. The link shows some useful visualizations of the distribution under different parameters. The Beta(1,1) distribution is uniform, Beta(5,5) has a peak at 0.5, Beta(1,4) has a peak at 0.25, Beta(0.1,0.1) has a minimum at 0.5 and has asymptotic behavior at 0 and 1.</p>
<p>Suppose we start with a uniform Dirichlet prior for each deck (<span class="math inline">\(\alpha_c = 1\)</span> for all <span class="math inline">\(c\)</span>), essentially starting from the position that all frequency combinations are equally likely. The intuition is that the model starts from the perspective that without any data, the probability that a random draw of a single card from any archetype <span class="math inline">\(i\)</span> is equal to any specific card <span class="math inline">\(c\)</span> is equal to <span class="math inline">\(1/n\)</span>, where <span class="math inline">\(n\)</span> is the number of unique cards (1,741 in my data). The probability that a random card from an Infect deck is Lightning Bolt is 1/1,741, the probability that a random card from a Tron deck is Urza’s Mine is 1/1,741, etc. The uncertainty about these probabilities is also the same for every card in every archetype. Of course these probabilities are wrong in practice, but they provide a sensible starting point and will be updated with data.</p>
<p>Next, we observe the training data for each archetype, <span class="math inline">\(D_t\)</span>. Assuming that each archetype has a unique set of card frequencies, using proper Bayesian updating, the posterior distribution of frequencies (the distribution conditional on the data) for each archetype is also Dirichlet with parameters <span class="math inline">\(\alpha_c = 1 + n_c\)</span>, the number of times card <span class="math inline">\(c\)</span> appeared in the archetype across all decks in <span class="math inline">\(D_t\)</span>. That is, starting from the prior stated above and given the training data, beliefs about the card frequencies for each archetype are described as above. To understand the intuition, after observing the training data, the probability that a single random card drawn from archetype <span class="math inline">\(i\)</span> is equal to a specific card <span class="math inline">\(c\)</span> is (1 + the number of card <span class="math inline">\(c\)</span> that appeared in archetype <span class="math inline">\(i\)</span> (<span class="math inline">\(n_{c,i}\)</span>))/(<span class="math inline">\(n\)</span> + the number of cards from archetype <span class="math inline">\(i\)</span> (<span class="math inline">\(n_i\)</span>)). For example, Lightning Bolt was never observed in an Infect deck, so the posterior expected probability that a random card from an Infect deck is Lightning Bolt is <span class="math inline">\((1+0)/(1,741+21,607) \approx 0.00013\)</span>. Four copies of Urza’s Mine were observed in every Tron deck, so the posterior expected probability that a random card from a Tron deck is Urza’s Mine is <span class="math inline">\((1+1,272)/(1,741+19,099) \approx 0.061\)</span>, which is pretty close to <span class="math inline">\(4/60 = 0.0\overline{6}\)</span>. Using this method, an Infect deck splashing Lightning Bolt would not be ruled impossible, just extremely unlikely, and the model has determined that nearly every Tron deck has four Urza’s Mines. The posterior also captures differing levels of confidence in these estimations. The variance in frequencies for archetypes observed many times in <span class="math inline">\(D_t\)</span> is lower than for archetypes observed fewer times because the variance decreases as the sum of the <span class="math inline">\(\alpha\)</span> parameters increases. In other words, I am more confident in the estimation of the frequency of Urza’s Mine in Tron, a heavily played deck, than I am about the frequency of Blood Moon in Skred Red decks, a rarely played deck.</p>
<p>Finally, when encountering a new deck, we want to compute a posterior probability that the deck came from each of the archetypes we saw in the training data. Adopting a prior that without data each archetype is equally probable, the likelihood alone will determine this probability. A new deck, <span class="math inline">\(D_{new}\)</span>, is a collection of 60 cards defined by a vector of <span class="math inline">\(x_c\)</span>’s, the number of times card <span class="math inline">\(c\)</span> appears in <span class="math inline">\(D_{new}\)</span>. Our model interprets this deck as a draw of size 60 from a Multinomial-Dirichlet distribution on the set of all unique cards with Dirichlet parameters set by the posterior described above. This distribution is a multinomial distribution where the frequency parameters are an unknown draw from a Dirichlet distribution. So, for each archetype, the likelihood is computed as as:</p>
<p><span class="math display">\[P(\text{archetype} = i | D_{new},D_t,\alpha=1) \propto P(D_{new} | \text{archetype} = i,D_t,\alpha=1) = \]</span> <span class="math display">\[f(D_{new};\text{size} = 60,\alpha_c = 1+n_{c,i}) = \frac{(60!) \Gamma(\sum_{c=1}^{1741} \alpha_c)}{\Gamma(60 + \sum_{c=1}^{1741} \alpha_c)} \prod_{c=1}^{1741} \frac{x_c + \alpha_c}{(x_c!) \Gamma(\alpha_c)} \]</span></p>
<p>Where <span class="math inline">\(f(x)\)</span> is the pmf of the Multinomial-Dirichlet distribution and <span class="math inline">\(\Gamma\)</span> is the gamma function, which is very similar to a factorial that can be applied non-integers. This function does look a lot more complicated than the simple likelihood before. That is because it is accounting for the uncertainty in the frequencies. You could simplify this function by using just the expectation of each frequency for each deck (<span class="math inline">\(\alpha_c\)</span> divided by the sum of the <span class="math inline">\(\alpha_c\)</span>s). That likelihood would look like the simple likelihood described previously where you can ignore the factorial constant and take the product of each expected probability exponentiated by <span class="math inline">\(x_c\)</span>. It would solve the problem of zero frequency cards. However, you would lose information about how confident you were in each expectation. The estimated frequencies of an archetype only observed twice in <span class="math inline">\(D_t\)</span> should be viewed with more suspicion than the frequencies for one observed 500 times. That is the reason the gamma functions outside of the product cannot be ignored in this likelihood.</p>
<p>After computing each of these, standardize them to sum to one and you have the probability that the new deck from each of the observed archetypes. Classify it into whichever archetype has the highest probability and you’re done!</p>
</div>
</div>
<div id="results" class="section level2">
<h2>Results</h2>
<p>Available on Github is R code that implements the above method, allowing for a flexible specification of <span class="math inline">\(\alpha\)</span> in the prior. I chose <span class="math inline">\(\alpha=1\)</span> because it represents starting from a uniform distribution, but the choice of prior is certainly open for debate. I also show the results for <span class="math inline">\(\alpha=0\)</span>, which corresponds to the initial maximum likelihood setup where zero frequencies are possible.</p>
<p>The results for <span class="math inline">\(\alpha\)</span> equal to 0, 1, and 0.01 are reported below. <span class="math inline">\(\alpha\)</span> of 0.01 corresponds to a prior with a smaller effect on the posterior (each <span class="math inline">\(\alpha_c\)</span> will be <span class="math inline">\(0.01 + n_{c,i}\)</span>) and frequencies closer to zero are more likely. Correct is the number of correct classifications, size is the number of decks classified, and rate is the ratio of those two. The Confident columns subset the results to classifications were the posterior probability of the suggested classification is greater than 95%.</p>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
Alpha
</th>
<th style="text-align:center;">
Correct
</th>
<th style="text-align:center;">
Size
</th>
<th style="text-align:center;">
Rate
</th>
<th style="text-align:center;">
Correct (Confident)
</th>
<th style="text-align:center;">
Size (Confident)
</th>
<th style="text-align:center;">
Rate (Confident)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
0.00
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
0.00
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
NaN
</td>
</tr>
<tr>
<td style="text-align:center;">
0.01
</td>
<td style="text-align:center;">
236
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
0.79
</td>
<td style="text-align:center;">
228
</td>
<td style="text-align:center;">
272
</td>
<td style="text-align:center;">
0.84
</td>
</tr>
<tr>
<td style="text-align:center;">
1.00
</td>
<td style="text-align:center;">
258
</td>
<td style="text-align:center;">
300
</td>
<td style="text-align:center;">
0.86
</td>
<td style="text-align:center;">
254
</td>
<td style="text-align:center;">
289
</td>
<td style="text-align:center;">
0.88
</td>
</tr>
</tbody>
</table>
<p>The value of <span class="math inline">\(\alpha=1\)</span> appears to be the most accurate, getting 86% of classifications correct, but the smaller <span class="math inline">\(\alpha\)</span> is not very different. It is also worth noting that the method appears to be too confident in its classifications. One would hope the accuracy rate would be similar to the estimated probability, but it appears that the classifications made with at least 95% probability have an accuracy rate well below that number.</p>
<p>I will look at the accuracy rate by archetype as well. The table below shows the five most frequent and five least frequent archetypes observed in the testing data. Total is the number of times the archetype appears, Proportion Correct is the proportion of those decks that are correctly classified, and Mode Incorrect is the most common incorrect classification (missing values indicate that all decks are correctly classified).</p>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Deck
</th>
<th style="text-align:center;">
Total
</th>
<th style="text-align:center;">
Proportion Correct
</th>
<th style="text-align:left;">
Mode Incorrect
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Affinity
</td>
<td style="text-align:center;">
19
</td>
<td style="text-align:center;">
1.00
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Infect
</td>
<td style="text-align:center;">
19
</td>
<td style="text-align:center;">
1.00
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Jund
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
1.00
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Naya Burn
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
0.67
</td>
<td style="text-align:left;">
Burn
</td>
</tr>
<tr>
<td style="text-align:left;">
Tron
</td>
<td style="text-align:center;">
14
</td>
<td style="text-align:center;">
1.00
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Wb Tokens
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.00
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Wg Hatebears
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.00
</td>
<td style="text-align:left;">
Gw Hatebears
</td>
</tr>
<tr>
<td style="text-align:left;">
Wilt-Leaf Abzan
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.00
</td>
<td style="text-align:left;">
Abzan
</td>
</tr>
<tr>
<td style="text-align:left;">
Wr Control
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.00
</td>
<td style="text-align:left;">
Wr Prison
</td>
</tr>
<tr>
<td style="text-align:left;">
Wu Control
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.00
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
<p>Affinity and Infect are very unique decks, so it is not surprising that the algorithm correctly classifies them. Jund is very similar to many other black green midrange decks, so I was surprised they were all correctly identified. That could be because Jund is a very common archetype in the training decks, so the algorithm has enough data to separate Jund from similar decks. Naya Burn was most frequently miss classified as normal Burn, which is not very surprising.</p>
<p>Among the least frequent archetypes, the mistakes are not unexpected. Its possible that WG Hatebears and GW Hatebears should be the same archetype anyway, and the Wilt-Leaf Abzan deck is just a special subset of Abzan decks that play the card Wilt-Leaf Liege.</p>
</div>
<div id="human-improvements" class="section level2">
<h2>Human Improvements</h2>
<p>I think a lot of the time, people want their statistical model to work without any human input. However, human-level tweaks often provide significantly greater performance improvements than tweaks to the statistical methods. Three areas where an analyst with domain knowledge could improve the method are outlined below.</p>
<p>First, standardizing deck archetypes. I made a few changes to these but wanted to leave the data mostly raw. For example, I made “U/R Twin” and “UR Twin” the same deck, changed “Death &amp; Taxes” to “Death And Taxes”, and standardized capitalization. Several remaining archetypes, however, should probably be grouped together. Some low hanging fruit are probably the 38 “Naya Through the Breach” decks and the 21 “Naya Titan Breach” decks, and the 88 “UB Tezzerator” and 26 “UB Tezzeret” decks. These kind of changes could be made incrementally as more data are added by standardizing the names of new decks and by someone who was unfamiliar with the code and statistics, but was familiar with the Modern format.</p>
<p>Another area an analyst could improve these results is by selectively including true zeros in the likelihood. For example, Abzan compared to Abzan Company decks differ by whether the card Collected Company is included in the list. With enough data, the algorithm will learn this distinction, but that identification could be expedited and accuracy increased if the Abzan likelihood function had a zero frequency for Collected Company. A similar method could be used to separate similar archetypes defined by color splashes, such as distinguishing Jeskai Twin, Grixis Twin, and UR Twin by including zeros for lands by which color they produce.</p>
<p>A third and final area more domain knowledge could help is manually reviewing low probability classifications. Let’s look at the most uncertain classifications. These six decks are the ones the algorithm had the most uncertainty about. An analyst could review the burn decks to separate which was Naya Burn and which was normal Burn (or potentially just combine those archetypes) and correctly identify color of the Eldrazi list.</p>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Deck
</th>
<th style="text-align:left;">
Classification
</th>
<th style="text-align:center;">
Probability Correct
</th>
<th style="text-align:left;">
Correct
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Eldrazi And Taxes
</td>
<td style="text-align:left;">
Eldrazi And Taxes
</td>
<td style="text-align:center;">
0.63
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
Mono-White Martyr
</td>
<td style="text-align:left;">
Mono-White Martyr
</td>
<td style="text-align:center;">
0.65
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
Gb Eldrazi
</td>
<td style="text-align:left;">
Colorless Eldrazi
</td>
<td style="text-align:center;">
0.76
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
Naya Burn
</td>
<td style="text-align:left;">
Naya Burn
</td>
<td style="text-align:center;">
0.77
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
Rw Nahiri
</td>
<td style="text-align:left;">
Rw Nahiri
</td>
<td style="text-align:center;">
0.79
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
Naya Burn
</td>
<td style="text-align:left;">
Burn
</td>
<td style="text-align:center;">
0.84
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
</tbody>
</table>
</div>
<div id="implementation-in-practice" class="section level2">
<h2>Implementation in Practice</h2>
<p>A company or data scientist building this tool frequent for use in an analysis pipeline would want to design a few features beyond the one-time estimation and classification described here.</p>
<p>Training data updating. CCGs evolve over time with new card releases and new discoveries by players. When a new archetype is formed, examples need to be added to the training data. To that end, and to update old archetypes with new cards, samples of decks should be regularly classified by humans and added to the training data, with special emphasis placed on getting sufficient samples of new archetypes. It would also be wise to sample more heavily from decks with low probability classifications and track accuracy rates of the new training decks. The updating is quite easy, simply add the additional card counts to the training data and the probabilities will be correctly calculated.</p>
<p>Archetype hierarchies. Many of the incorrect classifications were from mistaking sub-archetypes, such as confusing Naya Burn for Burn or Wilt-Leaf Abzan for Abzan. A two-stage classification could be more accurate and better address the questions practitioners are asking. An analyst would place some archetypes into categories, all Burn decks into one category and all Abzan into another. The algorithm would be implemented twice. Once to place a deck into a category then again to place the deck within that category. The higher-level category will probably be more accurate and sufficient for most practitioners’ purposes.</p>
<p>Prior selection. The uniform prior of <span class="math inline">\(\alpha = 1\)</span> is useful for interpretation, but practitioners may find it to be less accurate for archetypes with small sample sizes. Selecting the <span class="math inline">\(\alpha\)</span> that maximizes the accuracy rate in the training data is one simple option, or a cross-validation method could pick <span class="math inline">\(\alpha\)</span> to maximize the accuracy rate across many samples.</p>
<p>Incorporating game-specific features. Every CCG has unique deck-building rules, which could be built into the likelihood function. Magic decks cannot contain more than four of a single card and no fewer than 60 total cards, so frequencies greater than 4/60 are impossible. In Hearthstone, the cap is two for some cards, one for others, and decks must be exactly 30 cards. Deck size is already included as a parameter in the Multinomial-Dirichlet distribution, but card limits are not. Two alternatives I tried were treating each deck as a series of Bernoulli random variables indicating whether a card was present or not in a deck and treating a deck as a draw from several multinomial distributions of size 4 (or the appropriate card limit). They were not as accurate as the method described here, but potentially could be improved. At the least, they are worth experimenting with on new data sets.</p>
</div>
<div id="machine-learning-methods" class="section level2">
<h2>Machine Learning Methods</h2>
<p>I am certain that there are machine learning methods that address this problem as well. Classification is a well-studied topic in machine learning and this classification problem does not present too many unique challenges. However, I think this Bayesian approach has certain advantages in model updating and uncertainty quantification. It is quite easy to update the model with new, correctly-labeled decks. Simply add the new card counts the appropriate archetype in the training data. Many ML methods would need to re-calibrate tuning and regularization parameters with new training data, which could be quite time consuming. The second advantage is uncertainty quantification. Given the prior, this model explicitly reports the probability that the classification is correct. This is useful in flagging cases for manual review, as noted above.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>While not perfect, this algorithm should become quite adept at identifying archetypes with enough data. In formats without much turnover in the top decks, collecting the amount of data required is not very difficult. In rotating formats, however, it could be much harder. The people interested in this kind of application, however, might have more than just the top decks from weekend tournaments. Wizards of the Coast, the company that makes Magic, can observe every game played on Magic Online, tournament organizers collect deck lists from every player, and Vicious Syndicate has a popular deck tracking app for Hearthstone. They can certainly collect enough samples of decks, and perhaps the method described here could improve their classification accuracy or reduce the human labor required.</p>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/classification/">Classification</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/bayesian/">Bayesian</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/genetics/">Genetics</a>
  
</div>




    
    

    

    


  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

